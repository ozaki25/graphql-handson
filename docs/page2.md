# GraphQLって何！

## ゴール

- GraphQLでどんなことができるのか理解する
- どんな登場人物がいるのか理解する

## GraphQLとは

- Facebookが開発したAPIにアクセスするためのクエリ言語
- クライアントからサーバへのアクセスをクエリ言語で操作できる
    - SQLを叩くような感じでサーバにアクセスできる

## GraphQLを使った通信のイメージ

![GraphQL](/images/2-1.png)

- サーバがGraphQLを用いてAPIを公開し、クライアントがGraphQLを用いてアクセスすることで利用できる
    - 双方がGraphQLに対応している必要がある
- GraphQLでラップされているとはいえ単なるHTTP通信でしかない
    - パラメータの構築などはGraphQLのライブラリがやってくれる
    - なのでクエリを叩いているような感覚で通信処理を実装できる

### GraphQLの特徴

- エンドポイントが一つ
    - POSTの`/graphql`しか使わない
    - 処理の振り分けは全てパラメータで行う
- オーバーフェッチ/アンダーフェッチがない
    - 必要な情報だけを過不足なく取得できる
    - 例えばユーザ一覧を取得するときに名前だけでいいのに部署や年齢を取得してしまうようなことがない
        - モバイル環境を考えると通信するデータ量は少しでも削減したい
- 一度の通信で必要なデータを取得できる
    - ネストするような情報でも一度の通信で取得できる
    - 部署情報と所属する社員情報がほしい時にRESTだと2本必要だが1本で取得できる

## GraphQLの仕組み

### Query/Mutation

- 取得系の処理は**Query**、操作系の処理は**Mutation**を実行する
- RESTでいうところのGETはQuery
![query](/images/2-2.png)
- RESTでいうところのPOST/PUT/PATCH/DELETEはMutation
![mutation](/images/2-3.png)
- どのようなQueryやMutationを実行できるかはサーバ側で定義する
    - クライアントはそれらを実行することになる

### Type

- GraphQLはデータの型を定義できる
- 型の種類
    - StringやIntといった事前に定義された型
    - UserやDepartmentなど独自に定義する型
        - フィールドを持つことができる
- クライアントはサーバで定義された型に従ってほしいフィールドを指定する
    - 指定したフィールドのみ取得できるためオーバーフェッチが発生しない

![type](/images/2-4.png)

### Schema

- 実行可能なQueryやMutationの一覧、それらに紐づく型の情報をSchemaと呼ぶ
- この一覧を公開することでクライアントが何を実行できるのか知ることができる
![schema](/images/2-5.png)

### Resolver

- QueryやMutationが実行された時にどのような処理をするのかの定義したもの
    - 処理の中ではビジネスロジックを実行したりDBアクセスを行うことになる
    - 使用するプログラミング言語やライブラリのお作法にのっとって書くことになる
- SchemaのQuery/Mutationと対になるように定義する
![resolver](/images/2-6.png)


### Response

- GraphQLのレスポンスのフォーマットは基本的に`data`と`error`の2つのフィイールドとなる
- `data`にはレスポンスの本体を格納する
![success](/images/2-7.png)
- `error`にはエラーがあった場合にエラーの情報を格納する
    - 内容は特に決まっていないのでプロジェクトごとにどんな情報を返すか決める
![error](/images/2-8.png)


